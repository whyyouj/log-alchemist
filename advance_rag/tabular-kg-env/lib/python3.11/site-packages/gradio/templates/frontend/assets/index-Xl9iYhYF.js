const __vite__fileDeps=["./wrapper-CviSselG-DCvi549i.js","./__vite-browser-external-DFe-p4yY.js","./Index-CdNwo3lV.js","./Index-DTatRqhb.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import*as Y from"./svelte/svelte.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();const Se="modulepreload",Ee=function(e,t){return new URL(e,t).href},re={},ee=function(t,s,i){let n=Promise.resolve();if(s&&s.length>0){const o=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),a=r?.nonce||r?.getAttribute("nonce");n=Promise.all(s.map(u=>{if(u=Ee(u,i),u in re)return;re[u]=!0;const l=u.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(!!i)for(let g=o.length-1;g>=0;g--){const S=o[g];if(S.href===u&&(!l||S.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${d}`))return;const p=document.createElement("link");if(p.rel=l?"stylesheet":Se,l||(p.as="script",p.crossOrigin=""),p.href=u,a&&p.setAttribute("nonce",a),document.head.appendChild(p),l)return new Promise((g,S)=>{p.addEventListener("load",g),p.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${u}`)))})}))}return n.then(()=>t()).catch(o=>{const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=o,window.dispatchEvent(r),!r.defaultPrevented)throw o})};var $e=Object.defineProperty,Ce=(e,t,s)=>t in e?$e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,_=(e,t,s)=>(Ce(e,typeof t!="symbol"?t+"":t,s),s),Q=new Intl.Collator(0,{numeric:1}).compare;function ke(e,t,s){return e=e.split("."),t=t.split("."),Q(e[0],t[0])||Q(e[1],t[1])||(t[2]=t.slice(2).join("."),s=/[.-]/.test(e[2]=e.slice(2).join(".")),s==/[.-]/.test(t[2])?Q(e[2],t[2]):s?-1:1)}const Oe="config",Ne="info",Ae="https://gradio-space-api-fetcher-v2.hf.space/api",pe="This application is too busy. Keep trying!",j="Connection errored out.";function he(e,t,s){return t.startsWith("http://")||t.startsWith("https://")?s?e:t:e+t}async function Te(e,t){try{return(await(await fetch(`https://huggingface.co/api/spaces/${e}/jwt`,{headers:{Authorization:`Bearer ${t}`}})).json()).token||!1}catch(s){return console.error(s),!1}}function De(e){let t={};return e.forEach(({api_name:s},i)=>{s&&(t[s]=i)}),t}async function Pe(e){const t=this.options.hf_token?{Authorization:`Bearer ${this.options.hf_token}`}:{};if(t["Content-Type"]="application/json",typeof window<"u"&&window.gradio_config&&location.origin!=="http://localhost:9876"&&!window.gradio_config.dev_mode){const s=window.gradio_config.root,i=window.gradio_config;let n=he(e,i.root,!1);return i.root=n,{...i,path:s}}else if(e){const s=await this.fetch_implementation(`${e}/${Oe}`,{headers:t});if(s?.status===200){let i=await s.json();return i.path=i.path??"",i.root=e,i}throw new Error("Could not get config.")}throw new Error("No config or app endpoint found")}function X(e){if(e.startsWith("http")){const{protocol:t,host:s}=new URL(e);return s.endsWith("hf.space")?{ws_protocol:"wss",host:s,http_protocol:t}:{ws_protocol:t==="https:"?"wss":"ws",http_protocol:t,host:s}}else if(e.startsWith("file:"))return{ws_protocol:"ws",http_protocol:"http:",host:"lite.local"};return{ws_protocol:"wss",http_protocol:"https:",host:e}}const de=/^[^\/]*\/[^\/]*$/,qe=/.*hf\.space\/{0,1}$/;async function fe(e,t){const s={};t&&(s.Authorization=`Bearer ${t}`);const i=e.trim();if(de.test(i))try{const n=await fetch(`https://huggingface.co/api/spaces/${i}/host`,{headers:s});if(n.status!==200)throw new Error("Space metadata could not be loaded.");const o=(await n.json()).host;return{space_id:e,...X(o)}}catch(n){throw new Error("Space metadata could not be loaded."+n.message)}if(qe.test(i)){const{ws_protocol:n,http_protocol:o,host:r}=X(i);return{space_id:r.replace(".hf.space",""),ws_protocol:n,http_protocol:o,host:r}}return{space_id:!1,...X(i)}}function xe(e,t,s){const i={named_endpoints:{},unnamed_endpoints:{}};return Object.keys(e).forEach(n=>{(n==="named_endpoints"||n==="unnamed_endpoints")&&(i[n]={},Object.entries(e[n]).forEach(([o,{parameters:r,returns:a}])=>{const u=t.dependencies.findIndex(c=>c.api_name===o)||s[o.replace("/","")]||-1,l=u!==-1?t.dependencies[u].types:{continuous:!1,generator:!1},d=(c,p,g,S)=>({...c,description:je(c.type,g),type:Re(c.type,p,g,S)||""});i[n][o]={parameters:r.map(c=>d(c,c.component,c.serializer,"parameter")),returns:a.map(c=>d(c,c.component,c.serializer,"return")),type:l}}))}),i}function Re(e,t,s,i){switch(e.type){case"string":return"string";case"boolean":return"boolean";case"number":return"number"}if(s==="JSONSerializable"||s==="StringSerializable")return"any";if(s==="ListStringSerializable")return"string[]";if(t==="Image")return i==="parameter"?"Blob | File | Buffer":"string";if(s==="FileSerializable")return e?.type==="array"?i==="parameter"?"(Blob | File | Buffer)[]":"{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}[]":i==="parameter"?"Blob | File | Buffer":"{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}";if(s==="GallerySerializable")return i==="parameter"?"[(Blob | File | Buffer), (string | null)][]":"[{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}, (string | null))][]"}function je(e,t){return t==="GallerySerializable"?"array of [file, label] tuples":t==="ListStringSerializable"?"array of strings":t==="FileSerializable"?"array of files or single file":e.description}function Z(e,t){switch(e.msg){case"send_data":return{type:"data"};case"send_hash":return{type:"hash"};case"queue_full":return{type:"update",status:{queue:!0,message:pe,stage:"error",code:e.code,success:e.success}};case"heartbeat":return{type:"heartbeat"};case"unexpected_error":return{type:"unexpected_error",status:{queue:!0,message:e.message,stage:"error",success:!1}};case"estimation":return{type:"update",status:{queue:!0,stage:t||"pending",code:e.code,size:e.queue_size,position:e.rank,eta:e.rank_eta,success:e.success}};case"progress":return{type:"update",status:{queue:!0,stage:"pending",code:e.code,progress_data:e.progress_data,success:e.success}};case"log":return{type:"log",data:e};case"process_generating":return{type:"generating",status:{queue:!0,message:e.success?null:e.output.error,stage:e.success?"generating":"error",code:e.code,progress_data:e.progress_data,eta:e.average_duration},data:e.success?e.output:null};case"process_completed":return"error"in e.output?{type:"update",status:{queue:!0,message:e.output.error,stage:"error",code:e.code,success:e.success}}:{type:"complete",status:{queue:!0,message:e.success?void 0:e.output.error,stage:e.success?"complete":"error",code:e.code,progress_data:e.progress_data},data:e.success?e.output:null};case"process_starts":return{type:"update",status:{queue:!0,stage:"pending",code:e.code,size:e.rank,position:0,success:e.success,eta:e.eta}}}return{type:"none",status:{stage:"error",queue:!0}}}async function Le(){if(this.api_info)return this.api_info;const{hf_token:e}=this.options,{config:t}=this,s={"Content-Type":"application/json"};if(e&&(s.Authorization=`Bearer ${e}`),!!t)try{let i;if(ke(t?.version||"2.0.0","3.30")<0?i=await this.fetch_implementation(Ae,{method:"POST",body:JSON.stringify({serialize:!1,config:JSON.stringify(t)}),headers:s}):i=await this.fetch_implementation(`${t?.root}/${Ne}`,{headers:s}),!i.ok)throw new Error(j);let n=await i.json();return"api"in n&&(n=n.api),n.named_endpoints["/predict"]&&!n.unnamed_endpoints[0]&&(n.unnamed_endpoints[0]=n.named_endpoints["/predict"]),xe(n,t,this.api_map)}catch(i){""+i.message}}async function _e(e,t,s){const i={};this.options.hf_token&&(i.Authorization=`Bearer ${this.options.hf_token}`);const n=1e3,o=[];for(let a=0;a<t.length;a+=n){const u=t.slice(a,a+n),l=new FormData;u.forEach(c=>{l.append("files",c)});try{const c=s?`${e}/upload?upload_id=${s}`:`${e}/upload`;var r=await this.fetch_implementation(c,{method:"POST",body:l,headers:i})}catch{return{error:j}}if(!r.ok)return{error:await r.text()};const d=await r.json();d&&o.push(...d)}return{files:o}}function ae(e,t,s){for(;s.length>1;){const n=s.shift();if(typeof n=="string"||typeof n=="number")e=e[n];else throw new Error("Invalid key type")}const i=s.shift();if(typeof i=="string"||typeof i=="number")e[i]=t;else throw new Error("Invalid key type")}async function te(e,t=void 0,s=[],i=!1,n=void 0){if(Array.isArray(e)){let o=[];return await Promise.all(e.map(async r=>{var a;let u=s.slice();u.push(r);const l=await te(e[r],i?((a=n?.parameters[r])==null?void 0:a.component)||void 0:t,u,!1,n);o=o.concat(l)})),o}else{if(globalThis.Buffer&&e instanceof globalThis.Buffer)return[{path:s,blob:t==="Image"?!1:new me([e]),type:t}];if(typeof e=="object"){let o=[];for(let r in e)if(e.hasOwnProperty(r)){let a=s.slice();a.push(r),o=o.concat(await te(e[r],void 0,a,!1,n))}return o}}return[]}function ze(e,t){var s,i,n,o;return!(((i=(s=t?.dependencies)==null?void 0:s[e])==null?void 0:i.queue)===null?t.enable_queue:(o=(n=t?.dependencies)==null?void 0:n[e])!=null&&o.queue)||!1}function Ie(e,t){return new Promise((s,i)=>{const n=new MessageChannel;n.port1.onmessage=({data:o})=>{n.port1.close(),s(o)},window.parent.postMessage(e,t,[n.port2])})}async function nt(e,t,s,i,n=_e){let o=(Array.isArray(e)?e:[e]).map(a=>a.blob);const r=o.filter(a=>a.size>(i??1/0));if(r.length)throw new Error(`File size exceeds the maximum allowed size of ${i} bytes: ${r.map(a=>a.name).join(", ")}`);return await Promise.all(await n(t,o,s).then(async a=>{if(a.error)throw new Error(a.error);return a.files?a.files.map((u,l)=>new oe({...e[l],path:u,url:t+"/file="+u})):[]}))}async function it(e,t){return e.map(s=>new oe({path:s.name,orig_name:s.name,blob:s,size:s.size,mime_type:s.type,is_stream:t}))}class oe{constructor({path:t,url:s,orig_name:i,size:n,blob:o,is_stream:r,mime_type:a,alt_text:u}){_(this,"path"),_(this,"url"),_(this,"orig_name"),_(this,"size"),_(this,"blob"),_(this,"is_stream"),_(this,"mime_type"),_(this,"alt_text"),_(this,"meta",{_type:"gradio.FileData"}),this.path=t,this.url=s,this.orig_name=i,this.size=n,this.blob=s?void 0:o,this.is_stream=r,this.mime_type=a,this.alt_text=u}}async function Ue(e,t,s){const i=this,n=await te(t,void 0,[],!0,s);return(await Promise.all(n.map(async({path:r,blob:a,type:u})=>{if(!a)return{path:r,type:u};const l=await i.upload_files(e,[a]),d=l.files&&l.files[0];return{path:r,file_url:d,type:u,name:a?.name}}))).forEach(({path:r,file_url:a,type:u,name:l})=>{if(u==="Gallery")ae(t,a,r);else if(a){const d=new oe({path:a,orig_name:l});ae(t,d,r)}}),t}async function Be(e,t,s){const i={"Content-Type":"application/json"};this.options.hf_token&&(i.Authorization=`Bearer ${this.options.hf_token}`);try{var n=await this.fetch_implementation(e,{method:"POST",body:JSON.stringify(t),headers:{...i,...s}})}catch{return[{error:j},500]}let o,r;try{o=await n.json(),r=n.status}catch(a){o={error:`Could not parse server response: ${a}`},r=500}return[o,r]}async function Fe(e,t){let s=!1,i=!1,n;if(!this.config)throw new Error("Could not resolve app config");if(typeof e=="number")n=this.config.dependencies[e];else{const o=e.replace(/^\//,"");n=this.config.dependencies[this.api_map[o]]}if(n?.types.continuous)throw new Error("Cannot call predict on this function as it may run forever. Use submit instead");return new Promise(async(o,r)=>{const a=this.submit(e,t||[]);let u;a.on("data",l=>{i&&(a.destroy(),o(l)),s=!0,u=l}).on("status",l=>{l.stage==="error"&&r(l),l.stage==="complete"&&(i=!0,s&&(a.destroy(),o(u)))})})}async function se(e,t,s){let i=t==="subdomain"?`https://huggingface.co/api/spaces/by-subdomain/${e}`:`https://huggingface.co/api/spaces/${e}`,n,o;try{if(n=await fetch(i),o=n.status,o!==200)throw new Error;n=await n.json()}catch{s({status:"error",load_status:"error",message:"Could not get space status",detail:"NOT_FOUND"});return}if(!n||o!==200)return;const{runtime:{stage:r},id:a}=n;switch(r){case"STOPPED":case"SLEEPING":s({status:"sleeping",load_status:"pending",message:"Space is asleep. Waking it up...",detail:r}),setTimeout(()=>{se(e,t,s)},1e3);break;case"PAUSED":s({status:"paused",load_status:"error",message:"This space has been paused by the author. If you would like to try this demo, consider duplicating the space.",detail:r,discussions_enabled:await ce(a)});break;case"RUNNING":case"RUNNING_BUILDING":s({status:"running",load_status:"complete",message:"",detail:r});break;case"BUILDING":s({status:"building",load_status:"pending",message:"Space is building...",detail:r}),setTimeout(()=>{se(e,t,s)},1e3);break;default:s({status:"space_error",load_status:"error",message:"This space is experiencing an issue.",detail:r,discussions_enabled:await ce(a)});break}}const Je=/^(?=[^]*\b[dD]iscussions{0,1}\b)(?=[^]*\b[dD]isabled\b)[^]*$/;async function ce(e){try{const s=(await fetch(`https://huggingface.co/api/spaces/${e}/discussions`,{method:"HEAD"})).headers.get("x-error-message");return!(s&&Je.test(s))}catch{return!1}}async function Ge(e,t){const s={};t&&(s.Authorization=`Bearer ${t}`);try{const i=await fetch(`https://huggingface.co/api/spaces/${e}/runtime`,{headers:s});if(i.status!==200)throw new Error("Space hardware could not be obtained.");const{hardware:n}=await i.json();return n.current}catch(i){throw new Error(i.message)}}async function We(e,t,s){const i={};s&&(i.Authorization=`Bearer ${s}`);const n={seconds:t};try{const o=await fetch(`https://huggingface.co/api/spaces/${e}/sleeptime`,{method:"POST",headers:{"Content-Type":"application/json",...i},body:JSON.stringify(n)});if(o.status!==200)throw new Error("Could not set sleep timeout on duplicated Space. Please visit *ADD HF LINK TO SETTINGS* to set a timeout manually to reduce billing charges.");return await o.json()}catch(o){throw new Error(o.message)}}const le=["cpu-basic","cpu-upgrade","cpu-xl","t4-small","t4-medium","a10g-small","a10g-large","a10g-largex2","a10g-largex4","a100-large","zero-a10g","h100","h100x8"];async function Me(e,t){const{hf_token:s,private:i,hardware:n,timeout:o}=t;if(n&&!le.includes(n))throw new Error(`Invalid hardware type provided. Valid types are: ${le.map(p=>`"${p}"`).join(",")}.`);const r={Authorization:`Bearer ${s}`,"Content-Type":"application/json"},a=(await(await fetch("https://huggingface.co/api/whoami-v2",{headers:r})).json()).name,u=e.split("/")[1],l={repository:`${a}/${u}`};i&&(l.private=!0);let d;n||(d=await Ge(e,s));const c=n||d||"cpu-basic";l.hardware=c;try{const p=await fetch(`https://huggingface.co/api/spaces/${e}/duplicate`,{method:"POST",headers:r,body:JSON.stringify(l)});if(p.status===409)try{return await G.connect(`${a}/${u}`,t)}catch(S){throw console.error("Failed to connect Client instance:",S),S}else if(p.status!==200)throw new Error(p.statusText);const g=await p.json();return await We(`${a}/${u}`,o||300,s),await G.connect(g.url,t)}catch(p){throw new Error(p)}}function Ke(){let{event_callbacks:e,unclosed_events:t,pending_stream_messages:s,stream_status:i,config:n}=this;if(!n)throw new Error("Could not resolve app config");i.open=!0;let o=null,r=new URLSearchParams({session_hash:this.session_hash}).toString(),a=new URL(`${n.root}/queue/data?${r}`);if(o=this.eventSource_factory(a),!o)throw new Error("Cannot connect to sse endpoint: "+a.toString());o.onmessage=async function(u){let l=JSON.parse(u.data);if(l.msg==="close_stream"){J(i,o);return}const d=l.event_id;if(!d)await Promise.all(Object.keys(e).map(c=>e[c](l)));else if(e[d]&&n){l.msg==="process_completed"&&["sse","sse_v1","sse_v2","sse_v2.1"].includes(n.protocol)&&(t.delete(d),t.size===0&&J(i,o));let c=e[d];window.setTimeout(c,0,l)}else s[d]||(s[d]=[]),s[d].push(l)},o.onerror=async function(){await Promise.all(Object.keys(e).map(u=>e[u]({msg:"unexpected_error",message:j}))),J(i,o)}}function J(e,t){e&&t&&(e.open=!1,t?.close())}function He(e,t,s){!e[t]?(e[t]=[],s.data.forEach((n,o)=>{e[t][o]=n})):s.data.forEach((n,o)=>{let r=Ve(e[t][o],n);e[t][o]=r,s.data[o]=r})}function Ve(e,t){return t.forEach(([s,i,n])=>{e=Ye(e,i,s,n)}),e}function Ye(e,t,s,i){if(t.length===0){if(s==="replace")return i;if(s==="append")return e+i;throw new Error(`Unsupported action: ${s}`)}let n=e;for(let r=0;r<t.length-1;r++)n=n[t[r]];const o=t[t.length-1];switch(s){case"replace":n[o]=i;break;case"append":n[o]+=i;break;case"add":Array.isArray(n)?n.splice(Number(o),0,i):n[o]=i;break;case"delete":Array.isArray(n)?n.splice(Number(o),1):delete n[o];break;default:throw new Error(`Unknown action: ${s}`)}return e}function Qe(e,t,s,i){try{let n=function(y){const m=z[y.type]||[];m?.forEach(w=>w(y))},o=function(y,k){const m=z,w=m[y]||[];return m[y]=w,w?.push(k),{on:o,off:r,cancel:H,destroy:a}},r=function(y,k){const m=z;let w=m[y]||[];return w=w?.filter(T=>T!==k),m[y]=w,{on:o,off:r,cancel:H,destroy:a}},a=function(){var y;for(const k in z)z&&((y=z[k])==null||y.forEach(m=>{r(k,m)}))};const{hf_token:u}=this.options,{fetch_implementation:l,app_reference:d,config:c,session_hash:p,api_info:g,api_map:S,stream_status:L,pending_stream_messages:U,pending_diff_streams:B,event_callbacks:W,unclosed_events:ye,post_data:M}=this;if(!g)throw new Error("No API found");if(!c)throw new Error("Could not resolve app config");let{fn_index:h,endpoint_info:be,dependency:ve}=Xe(g,e,S,c),$,N,P=c.protocol??"ws";const f=typeof e=="number"?"/predict":e;let F,E=null,C=!1;const z={};let K={},R=typeof window<"u"?new URLSearchParams(window.location.search).toString():"";async function H(){const y={stage:"complete",queue:!1,time:new Date};C=y,n({...y,type:"status",endpoint:f,fn_index:h});let k={};P==="ws"?($&&$.readyState===0?$.addEventListener("open",()=>{$.close()}):$.close(),k={fn_index:h,session_hash:p}):(N?.close(),k={event_id:E});try{if(!c)throw new Error("Could not resolve app config");await l(`${c.root}/reset`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(k)})}catch{console.warn("The `/reset` endpoint could not be called. Subsequent endpoint results may be unreliable.")}}return this.handle_blob(`${c.root}`,t,be).then(async y=>{if(F={data:y||[],event_data:s,fn_index:h,trigger_id:i},ze(h,c))n({type:"status",endpoint:f,stage:"pending",queue:!1,fn_index:h,time:new Date}),M(`${c.root}/run${f.startsWith("/")?f:`/${f}`}${R?"?"+R:""}`,{...F,session_hash:p}).then(([m,w])=>{const T=m.data;w==200?(n({type:"data",endpoint:f,fn_index:h,data:T,time:new Date,event_data:s,trigger_id:i}),n({type:"status",endpoint:f,fn_index:h,stage:"complete",eta:m.average_duration,queue:!1,time:new Date})):n({type:"status",stage:"error",endpoint:f,fn_index:h,message:m.error,queue:!1,time:new Date})}).catch(m=>{n({type:"status",stage:"error",message:m.message,endpoint:f,fn_index:h,queue:!1,time:new Date})});else if(P=="ws"){const{ws_protocol:m,host:w}=await fe(d,u);n({type:"status",stage:"pending",queue:!0,endpoint:f,fn_index:h,time:new Date});let T=new URL(`${m}://${he(w,c.path,!0)}/queue/join${R?"?"+R:""}`);this.jwt&&T.searchParams.set("__sign",this.jwt),$=new WebSocket(T),$.onclose=D=>{D.wasClean||n({type:"status",stage:"error",broken:!0,message:j,queue:!0,endpoint:f,fn_index:h,time:new Date})},$.onmessage=function(D){const A=JSON.parse(D.data),{type:v,status:O,data:q}=Z(A,K[h]);if(v==="update"&&O&&!C)n({type:"status",endpoint:f,fn_index:h,time:new Date,...O}),O.stage==="error"&&$.close();else if(v==="hash"){$.send(JSON.stringify({fn_index:h,session_hash:p}));return}else v==="data"?$.send(JSON.stringify({...F,session_hash:p})):v==="complete"?C=O:v==="log"?n({type:"log",log:q.log,level:q.level,endpoint:f,fn_index:h}):v==="generating"&&n({type:"status",time:new Date,...O,stage:O?.stage,queue:!0,endpoint:f,fn_index:h});q&&(n({type:"data",time:new Date,data:q.data,endpoint:f,fn_index:h,event_data:s,trigger_id:i}),C&&(n({type:"status",time:new Date,...C,stage:O?.stage,queue:!0,endpoint:f,fn_index:h}),$.close()))},semiver(c.version||"2.0.0","3.6")<0&&addEventListener("open",()=>$.send(JSON.stringify({hash:p})))}else if(P=="sse"){n({type:"status",stage:"pending",queue:!0,endpoint:f,fn_index:h,time:new Date});var k=new URLSearchParams({fn_index:h.toString(),session_hash:p}).toString();let m=new URL(`${c.root}/queue/join?${R?R+"&":""}${k}`);if(N=this.eventSource_factory(m),!N)throw new Error("Cannot connect to sse endpoint: "+m.toString());N.onmessage=async function(w){const T=JSON.parse(w.data),{type:D,status:A,data:v}=Z(T,K[h]);if(D==="update"&&A&&!C)n({type:"status",endpoint:f,fn_index:h,time:new Date,...A}),A.stage==="error"&&N?.close();else if(D==="data"){E=T.event_id;let[O,q]=await M(`${c.root}/queue/data`,{...F,session_hash:p,event_id:E});q!==200&&(n({type:"status",stage:"error",message:j,queue:!0,endpoint:f,fn_index:h,time:new Date}),N?.close())}else D==="complete"?C=A:D==="log"?n({type:"log",log:v.log,level:v.level,endpoint:f,fn_index:h}):D==="generating"&&n({type:"status",time:new Date,...A,stage:A?.stage,queue:!0,endpoint:f,fn_index:h});v&&(n({type:"data",time:new Date,data:v.data,endpoint:f,fn_index:h,event_data:s,trigger_id:i}),C&&(n({type:"status",time:new Date,...C,stage:A?.stage,queue:!0,endpoint:f,fn_index:h}),N?.close()))}}else if(P=="sse_v1"||P=="sse_v2"||P=="sse_v2.1"||P=="sse_v3"){n({type:"status",stage:"pending",queue:!0,endpoint:f,fn_index:h,time:new Date});let m=window.location.hostname;const T=m.includes(".dev.")?`https://moon-${m.split(".")[1]}.dev.spaces.huggingface.tech`:"https://huggingface.co";(ve.zerogpu&&window.parent!=window&&c.space_id?Ie("zerogpu-headers",T):Promise.resolve(null)).then(v=>M(`${c.root}/queue/join?${R}`,{...F,session_hash:p},v)).then(([v,O])=>{if(O===503)n({type:"status",stage:"error",message:pe,queue:!0,endpoint:f,fn_index:h,time:new Date});else if(O!==200)n({type:"status",stage:"error",message:j,queue:!0,endpoint:f,fn_index:h,time:new Date});else{E=v.event_id;let q=async function(V){try{const{type:x,status:b,data:I}=Z(V,K[h]);if(x=="heartbeat")return;if(x==="update"&&b&&!C)n({type:"status",endpoint:f,fn_index:h,time:new Date,...b});else if(x==="complete")C=b;else if(x=="unexpected_error")console.error("Unexpected error",b?.message),n({type:"status",stage:"error",message:b?.message||"An Unexpected Error Occurred!",queue:!0,endpoint:f,fn_index:h,time:new Date});else if(x==="log"){n({type:"log",log:I.log,level:I.level,endpoint:f,fn_index:h});return}else x==="generating"&&(n({type:"status",time:new Date,...b,stage:b?.stage,queue:!0,endpoint:f,fn_index:h}),I&&["sse_v2","sse_v2.1","sse_v3"].includes(P)&&He(B,E,I));I&&(n({type:"data",time:new Date,data:I.data,endpoint:f,fn_index:h}),C&&n({type:"status",time:new Date,...C,stage:b?.stage,queue:!0,endpoint:f,fn_index:h})),(b?.stage==="complete"||b?.stage==="error")&&(W[E]&&delete W[E],E in B&&delete B[E])}catch(x){console.error("Unexpected client exception",x),n({type:"status",stage:"error",message:"An Unexpected Error Occurred!",queue:!0,endpoint:f,fn_index:h,time:new Date}),["sse_v2","sse_v2.1"].includes(P)&&(J(L,N),L.open=!1)}};E in U&&(U[E].forEach(V=>q(V)),delete U[E]),W[E]=q,ye.add(E),L.open||this.open_stream()}})}}),{on:o,off:r,cancel:H,destroy:a}}catch(n){throw console.error("Submit function encountered an error:",n),n}}function Xe(e,t,s,i){let n,o,r;if(typeof t=="number")n=t,o=e.unnamed_endpoints[n],r=i.dependencies[t];else{const a=t.replace(/^\//,"");n=s[a],o=e.named_endpoints[t.trim()],r=i.dependencies[s[a]]}if(typeof n!="number")throw new Error("There is no endpoint matching that name of fn_index matching that number.");return{fn_index:n,endpoint_info:o,dependency:r}}class me extends Blob{constructor(t,s){super(t,s)}}class G{constructor(t,s={}){_(this,"app_reference"),_(this,"options"),_(this,"config"),_(this,"api_info"),_(this,"api_map",{}),_(this,"session_hash",Math.random().toString(36).substring(2)),_(this,"jwt",!1),_(this,"last_status",{}),_(this,"stream_status",{open:!1}),_(this,"pending_stream_messages",{}),_(this,"pending_diff_streams",{}),_(this,"event_callbacks",{}),_(this,"unclosed_events",new Set),_(this,"heartbeat_event",null),_(this,"view_api"),_(this,"upload_files"),_(this,"handle_blob"),_(this,"post_data"),_(this,"submit"),_(this,"predict"),_(this,"open_stream"),_(this,"resolve_config"),this.app_reference=t,this.options=s,this.view_api=Le.bind(this),this.upload_files=_e.bind(this),this.handle_blob=Ue.bind(this),this.post_data=Be.bind(this),this.submit=Qe.bind(this),this.predict=Fe.bind(this),this.open_stream=Ke.bind(this),this.resolve_config=Pe.bind(this)}fetch_implementation(t,s){return fetch(t,s)}eventSource_factory(t){return typeof window!==void 0&&typeof EventSource<"u"?new EventSource(t.toString()):null}async init(){var t;if((typeof window>"u"||!("WebSocket"in window))&&!global.WebSocket){const s=await ee(()=>import("./wrapper-CviSselG-DCvi549i.js"),__vite__mapDeps([0,1]),import.meta.url);me=(await ee(()=>import("./__vite-browser-external-DFe-p4yY.js").then(i=>i._),[],import.meta.url)).Blob,global.WebSocket=s.WebSocket}try{await this._resolve_config().then(async({config:s})=>{if(s&&(this.config=s,this.config)){const i=new URL(`${this.config.root}/heartbeat/${this.session_hash}`);this.heartbeat_event=this.eventSource_factory(i),this.config.space_id&&this.options.hf_token&&(this.jwt=await Te(this.config.space_id,this.options.hf_token))}})}catch(s){throw Error(`Could not resolve config: ${s}`)}this.api_info=await this.view_api(),this.api_map=De(((t=this.config)==null?void 0:t.dependencies)||[])}static async connect(t,s={}){const i=new this(t,s);return await i.init(),i}close(){var t;(t=this.heartbeat_event)==null||t.close()}static async duplicate(t,s={}){return Me(t,s)}async _resolve_config(){const{http_protocol:t,host:s,space_id:i}=await fe(this.app_reference,this.options.hf_token),{status_callback:n}=this.options;let o;try{if(o=await this.resolve_config(`${t}//${s}`),!o)throw new Error("Could not resolve app config");return this.config_success(o)}catch(r){console.error(r),i?se(i,de.test(i)?"space_name":"subdomain",this.handle_space_success):n&&n({status:"error",message:"Could not load this space.",load_status:"error",detail:"NOT_FOUND"})}}async config_success(t){if(this.config=t,typeof window<"u"&&window.location.protocol==="https:"&&(this.config.root=this.config.root.replace("http://","https://")),this.config.auth_required)return this.prepare_return_obj();try{this.api_info=await this.view_api()}catch(s){console.error(`Could not get API details: ${s.message}`)}return this.prepare_return_obj()}async handle_space_success(t){const{status_callback:s}=this.options;if(s&&s(t),t.status==="running")try{if(this.config=await this._resolve_config(),!this.config)throw new Error("Could not resolve app config");return await this.config_success(this.config)}catch(i){console.error(i),s&&s({status:"error",message:"Could not load this space.",load_status:"error",detail:"NOT_FOUND"})}}async component_server(t,s,i){var n;if(!this.config)throw new Error("Could not resolve app config");const o={},{hf_token:r}=this.options,{session_hash:a}=this;r&&(o.Authorization=`Bearer ${this.options.hf_token}`);let u,l=this.config.components.find(c=>c.id===t);(n=l?.props)!=null&&n.root_url?u=l.props.root_url:u=this.config.root;let d;if("binary"in i){d=new FormData;for(const c in i.data)c!=="binary"&&d.append(c,i.data[c]);d.set("component_id",t.toString()),d.set("fn_name",s),d.set("session_hash",a)}else d=JSON.stringify({data:i,component_id:t,fn_name:s,session_hash:a}),o["Content-Type"]="application/json";r&&(o.Authorization=`Bearer ${r}`);try{const c=await this.fetch_implementation(`${u}/component_server/`,{method:"POST",body:d,headers:o});if(!c.ok)throw new Error("Could not connect to component server: "+c.statusText);return await c.json()}catch(c){console.warn(c)}}prepare_return_obj(){return{config:this.config,predict:this.predict,submit:this.submit,view_api:this.view_api,component_server:this.component_server}}}let ge=!1;"attachShadow"in Element.prototype&&"adoptedStyleSheets"in Document.prototype&&(ge="adoptedStyleSheets"in document.createElement("div").attachShadow({mode:"open"}));function ue(e,t){const s=new URL(import.meta.url).origin,i=new URL(e,s).href;if(document.querySelector(`link[href='${i}']`))return Promise.resolve();const o=document.createElement("link");return o.rel="stylesheet",o.href=i,new Promise((r,a)=>{o.addEventListener("load",()=>r()),o.addEventListener("error",()=>{console.error(`Unable to preload CSS for ${i}`),r()}),t.appendChild(o)})}function ot(e,t,s=document.createElement("style")){if(!ge)return null;s.remove();const i=new CSSStyleSheet;i.replaceSync(e);let n="";e=e.replace(/@import\s+url\((.*?)\);\s*/g,(u,l)=>(n+=`@import url(${l});
`,""));const o=i.cssRules;let r="",a=`gradio-app .gradio-container.gradio-container-${t} .contain `;for(let u=0;u<o.length;u++){const l=o[u];let d=l.cssText.includes(".dark");if(l instanceof CSSStyleRule){const c=l.selectorText;if(c){const p=c.replace(".dark","").split(",").map(g=>`${d?".dark":""} ${a} ${g.trim()} `).join(",");r+=l.cssText,r+=l.cssText.replace(c,p)}}else if(l instanceof CSSMediaRule){let c=`@media ${l.media.mediaText} {`;for(let p=0;p<l.cssRules.length;p++){const g=l.cssRules[p];if(g instanceof CSSStyleRule){let S=g.cssText.includes(".dark ");const L=g.selectorText,U=L.replace(".dark","").split(",").map(B=>`${S?".dark":""} ${a} ${B.trim()} `).join(",");c+=g.cssText.replace(L,U)}}c+="}",r+=c}else if(l instanceof CSSKeyframesRule){r+=`@keyframes ${l.name} {`;for(let c=0;c<l.cssRules.length;c++){const p=l.cssRules[c];p instanceof CSSKeyframeRule&&(r+=`${p.keyText} { ${p.style.cssText} }`)}r+="}"}else l instanceof CSSFontFaceRule&&(r+=`@font-face { ${l.style.cssText} }`)}return r=n+r,s.textContent=r,document.head.appendChild(s),s}const Ze="./assets/index-9MP2aYHk.css";let ne;ne=[];let ie,we,et=new Promise(e=>{we=e});async function tt(){ie=(await ee(()=>import("./Index-CdNwo3lV.js").then(e=>e.k),__vite__mapDeps([2,3]),import.meta.url)).default,we()}function st(){const e={SvelteComponent:Y.SvelteComponent};for(const s in Y)s!=="SvelteComponent"&&(s==="SvelteComponentDev"?e[s]=e.SvelteComponent:e[s]=Y[s]);window.__gradio__svelte__internal=e;class t extends HTMLElement{constructor(){super(),this.host=this.getAttribute("host"),this.space=this.getAttribute("space"),this.src=this.getAttribute("src"),this.control_page_title=this.getAttribute("control_page_title"),this.initial_height=this.getAttribute("initial_height")??"300px",this.is_embed=this.getAttribute("embed")??"true",this.container=this.getAttribute("container")??"true",this.info=this.getAttribute("info")??!0,this.autoscroll=this.getAttribute("autoscroll"),this.eager=this.getAttribute("eager"),this.theme_mode=this.getAttribute("theme_mode"),this.updating=!1,this.loading=!1}async connectedCallback(){await tt(),this.loading=!0,this.app&&this.app.$destroy(),typeof ne!="string"&&ne.forEach(o=>ue(o,document.head)),await ue(Ze,document.head);const i=new CustomEvent("domchange",{bubbles:!0,cancelable:!1,composed:!0});new MutationObserver(o=>{this.dispatchEvent(i)}).observe(this,{childList:!0}),this.app=new ie({target:this,props:{space:this.space?this.space.trim():this.space,src:this.src?this.src.trim():this.src,host:this.host?this.host.trim():this.host,info:this.info!=="false",container:this.container!=="false",is_embed:this.is_embed!=="false",initial_height:this.initial_height,eager:this.eager==="true",version:"4-28-3",theme_mode:this.theme_mode,autoscroll:this.autoscroll==="true",control_page_title:this.control_page_title==="true",Client:G,app_mode:window.__gradio_mode__==="app"}}),this.updating&&this.setAttribute(this.updating.name,this.updating.value),this.loading=!1}static get observedAttributes(){return["src","space","host"]}async attributeChangedCallback(i,n,o){if(await et,(i==="host"||i==="space"||i==="src")&&o!==n){if(this.updating={name:i,value:o},this.loading)return;this.app&&this.app.$destroy(),this.space=null,this.host=null,this.src=null,i==="host"?this.host=o:i==="space"?this.space=o:i==="src"&&(this.src=o),this.app=new ie({target:this,props:{space:this.space?this.space.trim():this.space,src:this.src?this.src.trim():this.src,host:this.host?this.host.trim():this.host,info:this.info!=="false",container:this.container!=="false",is_embed:this.is_embed!=="false",initial_height:this.initial_height,eager:this.eager==="true",version:"4-28-3",theme_mode:this.theme_mode,autoscroll:this.autoscroll==="true",control_page_title:this.control_page_title==="true",Client:G,app_mode:window.__gradio_mode__==="app"}}),this.updating=!1}}}customElements.get("gradio-app")||customElements.define("gradio-app",t)}st();export{ee as _,ot as a,ue as m,it as p,nt as u};
//# sourceMappingURL=index-Xl9iYhYF.js.map
